#!/usr/bin/env bash

dotfiles_path=$(dirname "$0")

print_help() {
cat <<EOF
This script is basically just a wrapper for stow. Although for vim and xmonad it does
some additional work that is needed for them to function properly.
For vim it initializes the git submodules so that all vim plugins are properly installed.
For xmonad it installs xmonad and xmonad-contrib through cabal.

Available arguments are:
    --deploy popular (A basic alias for stow -v cower git... etc)
    --conclude popular (A basic alias for stow  -v -D cower git... etc)
    --vim (For creating the necessary folders, installation of plugins, and symlinking)
    --xmonad (For creating the necessary folders, installation of packages, and symlinking)
EOF
}

xmonad_wrapper() {
    if [[ ! -x /usr/bin/cabal ]] && [[ ! -x /usr/bin/ghc ]]; then
        echo "This option needs cabal and ghc to be installed. Try doing that first"
        exit
    fi
    cabal update && cabal install xmonad && cabal install xmonad-contrib
    stow -v xmonad
    echo "You also need to add \$HOME/.cabal/bin to your \$PATH. Or deploy zsh"
    echo "Which already has \$PATH configured appropriately."
}

vim_wrapper() {
    mkdir -p "$dotfiles_path"/vim/.vim/{autoload,bundle,backup,swap}
    git submodule init
    git submodule update
    stow -v vim
}

# Do not proceed if stow is not installed
if [[ ! -x /usr/bin/stow ]] || [[ ! -x /bin/stow ]]; then
    echo "This script needs stow, please install it with your package manager of preference"
    exit

# If stow is installed, then proceed with the following:
elif [[ $1 == "--deploy" ]] && [[ $2 == "popular" ]]; then
    stow -v cower git newsbeuter termite unclassified X X-xinitrc youtube zsh
    vim_wrapper
    xmonad_wrapper

elif [[ $1 == "--conclude" ]] && [[ $2 == "popular" ]]; then
    stow -v --delete cower git newsbeuter termite unclassified X X-xinitrc youtube zsh xmonad vim

# What to do for when we want to deploy vim
elif [[ $1 == "--vim" ]]; then
    vim_wrapper

# What to do for when we want to deploy xmonad
elif [[ $1 == "--xmonad" ]]; then
    xmonad_wrapper

# Display the help
else
    print_help
fi
